<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f0f1e">
    <title>Rewards - Solo Leveling System</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <h1>REWARD SHOP</h1>
                <p class="subtitle">Spend Your Gold Wisely</p>
            </div>
            <div class="gold-display">ğŸ’° <span id="shopGold">0</span></div>
        </header>

        <!-- Main Content -->
        <main class="rewards-page">
            <!-- Reward Categories -->
            <section class="reward-categories">
                <button class="category-btn active" data-category="all">All Rewards</button>
                <button class="category-btn" data-category="power">âš¡ Power</button>
                <button class="category-btn" data-category="boost">ğŸ“ˆ Boost</button>
                <button class="category-btn" data-category="cosmetic">âœ¨ Cosmetic</button>
            </section>

            <!-- Rewards List -->
            <section class="rewards-list" id="rewardsList">
                <!-- Generated by JavaScript -->
            </section>

            <!-- Purchase History -->
            <section class="purchase-history">
                <h3 class="section-title">ğŸ“œ PURCHASE HISTORY</h3>
                <div class="history-list" id="historyList">
                    <p class="empty-state">No purchases yet.</p>
                </div>
            </section>

            <!-- Navigation Menu -->
            <nav class="nav-menu">
                <a href="index.html" class="nav-btn" data-page="dashboard">
                    <span class="nav-icon">âš”ï¸</span>
                    <span class="nav-label">Dashboard</span>
                </a>
                <a href="quests.html" class="nav-btn" data-page="quests">
                    <span class="nav-icon">ğŸ“œ</span>
                    <span class="nav-label">Quests</span>
                </a>
                <a href="habits.html" class="nav-btn" data-page="habits">
                    <span class="nav-icon">ğŸ”„</span>
                    <span class="nav-label">Habits</span>
                </a>
                <a href="rewards.html" class="nav-btn active" data-page="rewards">
                    <span class="nav-icon">ğŸ</span>
                    <span class="nav-label">Rewards</span>
                </a>
                <a href="awakening.html" class="nav-btn" data-page="awakening">
                    <span class="nav-icon">âœ¨</span>
                    <span class="nav-label">Awakening</span>
                </a>
            </nav>
        </main>
    </div>

    <script src="app.js"></script>
    <script>
        const REWARDS = [
            {
                id: 1,
                name: 'XP Potion',
                description: 'Gain 100 bonus XP',
                cost: 500,
                category: 'power',
                icon: 'ğŸ§ª',
                effect: 'xp',
                value: 100
            },
            {
                id: 2,
                name: 'Double XP (24h)',
                description: 'Double XP gains for 24 hours',
                cost: 1000,
                category: 'boost',
                icon: '2ï¸âƒ£',
                effect: 'double-xp',
                duration: 86400000
            },
            {
                id: 3,
                name: 'Streak Protector',
                description: 'Protect your streak once',
                cost: 300,
                category: 'power',
                icon: 'ğŸ›¡ï¸',
                effect: 'protection'
            },
            {
                id: 4,
                name: 'Gold Rush (12h)',
                description: '+50% Gold gains for 12 hours',
                cost: 800,
                category: 'boost',
                icon: 'ğŸ’¸',
                effect: 'gold-boost',
                duration: 43200000
            },
            {
                id: 5,
                name: 'Hunter Title',
                description: 'Cosmetic title - "The Awakened"',
                cost: 200,
                category: 'cosmetic',
                icon: 'ğŸ‘‘',
                effect: 'title',
                value: 'The Awakened'
            },
            {
                id: 6,
                name: 'Premium Avatar Frame',
                description: 'Glowing avatar border',
                cost: 400,
                category: 'cosmetic',
                icon: 'âœ¨',
                effect: 'avatar-frame'
            },
            {
                id: 7,
                name: 'Level Boost',
                description: 'Gain 2 levels instantly',
                cost: 2000,
                category: 'power',
                icon: 'â¬†ï¸',
                effect: 'level-boost',
                value: 2
            },
            {
                id: 8,
                name: 'Midnight Theme',
                description: 'Unlock dark aesthetic cosmetic',
                cost: 150,
                category: 'cosmetic',
                icon: 'ğŸŒ™',
                effect: 'theme',
                value: 'midnight'
            }
        ];

        let currentCategory = 'all';
        let purchases = [];

        function loadPurchases() {
            const saved = localStorage.getItem('purchases');
            purchases = saved ? JSON.parse(saved) : [];
        }

        function savePurchases() {
            localStorage.setItem('purchases', JSON.stringify(purchases));
        }

        function renderRewards() {
            const filtered = currentCategory === 'all' ? REWARDS : REWARDS.filter(r => r.category === currentCategory);
            const player = getPlayer();
            const rewardsList = document.getElementById('rewardsList');

            document.getElementById('shopGold').textContent = player.gold;

            rewardsList.innerHTML = '';
            filtered.forEach(reward => {
                const canAfford = player.gold >= reward.cost;
                const isOwned = purchases.some(p => p.rewardId === reward.id);
                rewardsList.innerHTML += `
                    <div class="reward-card ${!canAfford ? 'unavailable' : ''} ${isOwned && reward.category === 'cosmetic' ? 'owned' : ''}">
                        <div class="reward-header">
                            <span class="reward-icon">${reward.icon}</span>
                            <h4 class="reward-name">${reward.name}</h4>
                        </div>
                        <p class="reward-desc">${reward.description}</p>
                        <div class="reward-footer">
                            <span class="reward-cost">ğŸ’° ${reward.cost}</span>
                            <button class="reward-btn ${!canAfford ? 'disabled' : ''}" data-id="${reward.id}" ${!canAfford ? 'disabled' : ''}>
                                ${isOwned ? 'âœ“ Owned' : 'Buy'}
                            </button>
                        </div>
                    </div>
                `;
            });

            attachRewardListeners();
        }

        function attachRewardListeners() {
            document.querySelectorAll('.reward-btn:not(.disabled):not(:has(* + .disabled))').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const rewardId = parseInt(e.target.dataset.id);
                    purchaseReward(rewardId);
                });
            });
        }

        function purchaseReward(rewardId) {
            const reward = REWARDS.find(r => r.id === rewardId);
            const player = getPlayer();

            if (player.gold < reward.cost) {
                alert('Insufficient gold!');
                return;
            }

            player.gold -= reward.cost;
            applyReward(reward);

            purchases.push({
                rewardId: reward.id,
                rewardName: reward.name,
                purchasedAt: new Date().toISOString()
            });

            savePlayer(player);
            savePurchases();
            renderRewards();
            renderHistory();

            alert(`âœ“ Purchased: ${reward.name}
${reward.icon} Effect Applied!`);
        }

        function applyReward(reward) {
            const player = getPlayer();

            switch (reward.effect) {
                case 'xp':
                    player.xp += reward.value;
                    checkLevelUp();
                    break;
                case 'level-boost':
                    player.level += reward.value;
                    player.xpForNextLevel = 100 + (player.level * 50);
                    break;
                case 'double-xp':
                    localStorage.setItem('doubleXPEnd', Date.now() + reward.duration);
                    break;
                case 'gold-boost':
                    localStorage.setItem('goldBoostEnd', Date.now() + reward.duration);
                    break;
                case 'protection':
                    const protections = parseInt(localStorage.getItem('streakProtections') || '0') + 1;
                    localStorage.setItem('streakProtections', protections);
                    break;
                case 'title':
                    player.title = reward.value;
                    break;
                case 'theme':
                    localStorage.setItem('theme', reward.value);
                    document.body.className = reward.value;
                    break;
            }

            savePlayer(player);
        }

        function renderHistory() {
            loadPurchases();
            const historyList = document.getElementById('historyList');

            if (purchases.length === 0) {
                historyList.innerHTML = '<p class="empty-state">No purchases yet.</p>';
                return;
            }

            historyList.innerHTML = purchases.slice().reverse().map(purchase => `
                <div class="history-item">
                    <span class="history-name">${purchase.rewardName}</span>
                    <span class="history-date">${new Date(purchase.purchasedAt).toLocaleDateString()}</span>
                </div>
            `).join('');
        }

        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentCategory = e.target.dataset.category;
                renderRewards();
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            renderRewards();
            renderHistory();
        });
    </script>
</body>
</html>
